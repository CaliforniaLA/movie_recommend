{% extends "base.html" %}
{% block title %}首页

{% endblock %}
{% block head %}
    {{ super() }}
    <style>
    #li-news{
        margin-top: 20px;
    }
    #row{
        font-size: larger;
        margin-left: 250px;
        margin-right: 300px;
    }
    a:link{
        color: black;
        text-decoration:none;
    }
    a:hover{
        color: #FF7E00;
        text-decoration:underline;
    }
    a:visited {
        color:#666666;
        text-decoration:none;
    }
    </style>
{% endblock %}

{% block content %}
<div id="news">

    <el-row type="flex" justify="center">
        <h1>新闻通知</h1>
    </el-row>
    <el-row type="flex" justify="center" >
            {% if current_user.is_admin %}
            <div >


            <el-input v-model="pub_new.title" placeholder="请输入新闻标题"></el-input>
            <el-input
                    type="textarea"
                    :rows="3"
                    placeholder="请输入新闻内容"
                    v-model="pub_new.content"
                    style="margin-top: 5px">
            </el-input>
            <el-button type="primary" size="small" @click="pubNews" style="margin-top: 5px">发布新闻</el-button>
            </div>
            {% endif %}
    </el-row>
    <el-row id="row">
        <ul>
       <li v-for="n in news" id="li-news">
           <a href="#" @click="goToNews(n.id)">{{n.title}}</a>
           {% if current_user.is_admin %}
           <span style="float: right;">
               <el-button type="text" @click="delNews(n.id)" size="small">删除新闻</el-button>
           </span>
           {% endif %}
           <span style="float: right;margin-right: 10px">[{{n.pub_date.substring(0,10)}}]</span>


       </li>
        </ul>
    </el-row>
</div>
{% endblock %}
{% block vue %}
<script>
    app.activeIndex= 'news';
    new Vue({
            el: '#news',
            data: {
                news: [],
                pub_new: {
                    state: false,
                    title: '',
                    content: ''
                }
            },

            methods: {
                goToNews:function (id) {
                  window.location.href = '/news_detail/' + id
                },
                delNews:function (id) {
                    this.$http.get('/del_news', {
                        params:{id:id}
                    }).then(function (data) {
                        this.msg = data.body;
                        if (this.msg === 'success') {
                            this.$message({
                                message:'删除成功！',
                                type:'success'
                            });
                            this.getAllNews();

                        } else {
                            this.$message.error('删除失败')
                        }
                    }, function (response) {
                        console.info(response);
                    })
                },
                pubNews: function () {
                    this.$http.post('/pub_news', {
                        title: this.pub_new.title,
                        content: this.pub_new.content
                    }, {emulateJSON: true}).then(function (data) {
                        this.pub_new.state = false;
                        this.pub_new.content = '';
                        this.pub_new.title='';
                        this.msg = data.body;
                        if (this.msg === 'success') {
                            this.getAllNews();

                        }
                    }, function (response) {
                        console.info(response);
                    })
                },
                getAllNews: function () {
                    this.$http.get('/news').then(function (data) {
                        this.news = data.body;
                    }, function (response) {
                        console.info(response);
                    })
                }
            },

            created: function () {
                this.getAllNews();
            }
        });
</script>
{% endblock %}